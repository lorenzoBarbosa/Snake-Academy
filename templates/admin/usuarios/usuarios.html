{% extends "index.html" %}
{%block conteudo%}
<article>
    <div class="container mt-5">
        <h1 class="titulo-home"><b>Usuários do Snake Academy</b></h1>
    </div>
    <div class="container mt-4">
        {% if redirect %}
        <input type="hidden" name="redirect" value="{{ redirect }}">
        {% endif %}

        {% if erros and "GERAL" in erros.keys() %}
        <div class="alert alert-danger">
            {{ erros['GERAL'] }}
        </div>
        {% endif %}
        <form method="post" action="/admin/usuarios/filtro">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="tipo_usuario" class="form-label">Tipo</label>
                    <select id="tipo_usuario" name="tipo_usuario" class="form-select" onchange="mostrarSubfiltros()">
                        <option value="todos">Todos</option>
                        <option value="clientes">Clientes</option>
                        <option value="professores">Professores</option>
                        <option value="administradores">Administradores</option>
                    </select>
                </div>

                <!-- Subfiltro: Usuários -->
                <div class="col-md-4" id="filtro_usuarios" style="display:none;">
                    <label for="status_usuario" class="form-label">Status do Cliente</label>
                    <select id="status_usuario" name="status_usuario" class="form-select">
                        <option value="">Todos</option>
                        <option value="matriculados">Matriculados</option>
                        <option value="sem_matricula">Sem matrícula</option>
                    </select>
                </div>
                <div class="col text-end mb-5">
                    <button type="submit" class="botao-login botao-filtro">Filtrar</button>
                    <a href="/usuarios" class="btn btn-secondary">Limpar</a>
                </div>
            </div>
        </form>
    </div>
    <div class="container mt-3">
        {% for usuario_filtro in usuarios %}
        <a href="/admin/usuarios/detalhes-usuario/{{ usuario_filtro.id }}">
            <div class="linha-usuario d-flex align-items-center justify-content-between px-3 py-2 mb-2">
                <!-- Foto + Nome + Cursos -->
                <div class="d-flex align-items-center">
                    <!-- Foto -->
                    <div class="foto-usuario me-3">
                        <img src="{{ usuario_filtro.foto }}" alt="{{ usuario_filtro.nome }}">
                    </div>
                    <!-- Nome + Perfil + Cursos -->
                    <div>
                        <h5 class="mb-1 d-flex align-items-center">
                            {{ usuario_filtro.nome }}
                            <span class="tag-usuario 
                                {% if usuario_filtro.perfil == 'cliente' %}tag-cliente{% endif %}
                                {% if usuario_filtro.perfil == 'professor' %}tag-professor{% endif %}
                                {% if usuario_filtro.perfil == 'admin' %}tag-admin{% endif %}
                            ">
                                {{ usuario_filtro.perfil|capitalize }}
                            </span>
                            {% if usuario_filtro.id == usuario.id %}
                                <span class="badge bg-info">Você</span>
                            {% endif %}
                        </h5>
                        {% if usuario_filtro.perfil == "admin"%}
                            <small>Administrador do sistema</small>
                        {% endif %}
                        {% if usuario_filtro.perfil == 'cliente' %}
                            <small>Cursos: {{ usuario_filtro.cursos|length }}</small>
                        {% endif %}
                        {% if usuario_filtro.perfil == 'professor' %}
                            <small>Cursos Ministrados: {{ usuario_filtro.cursosPostados|length }}</small>
                        {% endif %}
                    </div>
                </div>

                <!-- Ações -->
                <div class="acoes-usuario">
                    <button class="btn btn-sm btn-outline-primary me-2"><a href="/admin/denuncias/notificar-usuario/{{ usuario_filtro.id }}"><i class="bi bi-bell"></i>Notificar</a></button>
                    {% if usuario_filtro.perfil == "cliente" or usuario_filtro.perfil == "professor" %}
                    <button class="btn btn-sm btn-outline-success me-2"><a href="/admin/usuarios/confirmar-alteracao-status-admin/{{ usuario_filtro.id }}"><i class="bi bi-person-gear"></i>Tornar Admin</a></button>
                    {% endif %}
                </div>
            </div>
        </a>
        {% endfor %}
    </div>


</article>
<script>
    function mostrarSubfiltros() {
        const tipo = document.getElementById("tipo_usuario").value;
        document.getElementById("filtro_usuarios").style.display = (tipo === "clientes") ? "block" : "none";
    }
</script>
{%endblock%}