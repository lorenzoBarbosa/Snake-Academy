{% extends "index.html" %}

{% block conteudo %}
<article>
    <div class="sombra-baixo">
        <div class="container">
            <h1 class="titulo-home"><b>Tópicos</b></h1>
            <hr>
        </div>
    </div>

    <div class="container mt-3">
        <!-- Filtro por Categoria -->
        <div class="filtro-categoria-topico mb-4">
            <form method="get" action="/admin/topicos" class="d-flex align-items-center gap-3">
                <label for="categoria" class="fw-bold">Filtrar por Categoria:</label>
                <select name="categoria" id="categoria" class="form-select form-select-topico" onchange="filtrarPorCategoria(this)">
                    <option value="">Todas as Categorias</option>
                    {% for cat in categorias %}
                    <option value="{{ cat.id }}" {% if categoria_selecionada == cat.id %}selected{% endif %}>
                        {{ cat.nome }}
                    </option>
                    {% endfor %}
                </select>
            </form>
        </div>

        {% if topicos %}
        <table class="table table-striped table-admin-topico center-column-1-topico">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Nome do Tópico</th>
                    <th>Categoria</th>
                    <th class="text-center">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for topico in topicos %}
                <tr>
                    <td>{{ "{:06d}".format(topico.id) }}</td>
                    <td>{{ topico.nome }}</td>
                    <td>{{ topico.categoria.nome if topico.categoria else '-' }}</td>
                    <td class="text-center">
                        <a href="/admin/topicos/alterar-topico/{{ topico.id }}" class="btn btn-success btn-sm" title="Alterar">
                            <i class="bi-pencil"></i>
                        </a>
                        <a href="/admin/topicos/excluir-topico/{{ topico.id }}" class="btn btn-danger btn-sm" title="Excluir">
                            <i class="bi-trash"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="alert alert-warning" role="alert">
            {% if categoria_selecionada %}
            Nenhum tópico encontrado para esta categoria.
            {% else %}
            Nenhum tópico cadastrado.
            {% endif %}
        </div>
        {% endif %}

        {% if message %}
        <div class="alert alert-info mt-3" role="alert">
            {{ message }}
        </div>
        {% endif %}

        <!-- Botão de adicionar tópico centralizado -->
        <div class="d-flex justify-content-center mt-4 mb-5">
            <a href="/admin/topicos/inserir-topico" class="botao-cadastrar-banner-topico" title="Adicionar Tópico">
                <i class="bi bi-plus"></i>
            </a>
        </div>
    </div>
</article>

<script>
function filtrarPorCategoria(selectElement) {
    const valor = selectElement.value;
    if (valor === "") {
        // Se for "Todas as Categorias", redireciona sem parâmetro
        window.location.href = "/admin/topicos";
    } else {
        // Se tiver uma categoria selecionada, envia o formulário normalmente
        selectElement.form.submit();
    }
}
</script>
{% endblock %}