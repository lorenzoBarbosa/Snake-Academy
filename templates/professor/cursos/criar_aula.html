{% extends "index.html" %}
{% block conteudo %}
        <!-- Conteúdo Principal -->
        <div class="aula-content-wrapper">
            <div class="container" style="max-width: 1200px; padding: 20px;">
                <h1 class="aula-titulo-pagina">
                    <i class="bi bi-camera-video-fill" style="color: #5C22AD;"></i> 
                    Adicionar Aulas ao Módulo
                </h1>
                <p class="aula-subtitulo-pagina">Faça upload dos vídeos das aulas com título e descrição</p>

                <!-- Card Adicionar Nova Aula -->
                <div class="aula-card-criacao">
                    <h2 class="aula-secao-titulo">
                        <i class="bi bi-plus-circle-fill"></i> 
                        Nova Aula
                    </h2>

                    <!-- Upload de Vídeo -->
                    <div class="mb-4">
                        <label class="aula-form-label">Vídeo da Aula *</label>
                        <input type="file" id="inputVideo" class="aula-input-file" accept="video/*" onchange="selecionarVideo(event)">
                        
                        <div id="uploadArea" class="aula-upload-area" onclick="document.getElementById('inputVideo').click()">
                            <i class="bi bi-cloud-upload"></i>
                            <p>Clique para fazer upload do vídeo</p>
                            <small>Formatos aceitos: MP4, AVI, MOV (máx. 500MB)</small>
                        </div>

                        <div id="videoPreview" style="display: none;"></div>

                        <!-- Alternativa: URL do vídeo -->
                        <div class="mt-3">
                            <label class="aula-form-label">Ou insira a URL do vídeo (YouTube, Vimeo, etc.)</label>
                            <input type="url" class="aula-form-control" id="urlVideo" placeholder="https://youtube.com/watch?v=...">
                        </div>
                    </div>

                    <!-- Título da Aula -->
                    <div class="mb-4">
                        <label class="aula-form-label">Título da Aula *</label>
                        <input type="text" class="aula-form-control" id="tituloAula" placeholder="Ex: Introdução ao Python - Variáveis">
                    </div>

                    <!-- Descrição da Aula -->
                    <div class="mb-4">
                        <label class="aula-form-label">Descrição da Aula *</label>
                        <textarea class="aula-form-control" id="descricaoAula" placeholder="Descreva o conteúdo que será abordado nesta aula..."></textarea>
                    </div>

                    <button class="aula-btn-adicionar-video" onclick="adicionarAulaLista()">
                        <i class="bi bi-plus-lg"></i> Adicionar Aula à Lista
                    </button>
                </div>

                <!-- Card Lista de Aulas -->
                <div class="aula-card-criacao">
                    <h2 class="aula-secao-titulo">
                        <i class="bi bi-collection-play-fill"></i> 
                        Aulas Adicionadas
                        <span class="aula-badge-contador" id="contadorAulas">0 aulas</span>
                    </h2>

                    <div id="listaAulas" class="aula-videos-lista">
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <i class="bi bi-camera-video" style="font-size: 3rem; opacity: 0.3;"></i>
                            <p style="margin-top: 15px;">Nenhuma aula adicionada ainda</p>
                            <small>Preencha o formulário acima e clique em "Adicionar Aula à Lista"</small>
                        </div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="aula-botoes-acao">
                    <button class="aula-btn-cancelar" onclick="cancelar()">
                        <i class="bi bi-x-lg"></i> Cancelar
                    </button>
                    <button class="aula-btn-salvar" onclick="salvarAulas()">
                        <i class="bi bi-check-lg"></i> Salvar Todas as Aulas
                    </button>
                </div>
            </div>
        </div>
    </article>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let aulas = [];
        let videoAtual = null;

        // Selecionar vídeo
        function selecionarVideo(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validar tamanho (500MB)
            const maxSize = 500 * 1024 * 1024;
            if (file.size > maxSize) {
                alert('O arquivo é muito grande! Máximo permitido: 500MB');
                return;
            }

            videoAtual = file;

            // Mostrar preview
            const preview = document.getElementById('videoPreview');
            const uploadArea = document.getElementById('uploadArea');
            
            preview.innerHTML = `
                <div class="aula-video-preview">
                    <div class="aula-video-preview-icon">
                        <i class="bi bi-film"></i>
                    </div>
                    <div class="aula-video-preview-info">
                        <div class="aula-video-preview-nome">${file.name}</div>
                        <div class="aula-video-preview-tamanho">${(file.size / (1024 * 1024)).toFixed(2)} MB</div>
                    </div>
                    <button class="aula-btn-remover-video" onclick="removerVideo()">
                        <i class="bi bi-trash"></i> Remover
                    </button>
                </div>
            `;
            
            uploadArea.style.display = 'none';
            preview.style.display = 'block';
        }

        // Remover vídeo
        function removerVideo() {
            videoAtual = null;
            document.getElementById('inputVideo').value = '';
            document.getElementById('videoPreview').style.display = 'none';
            document.getElementById('uploadArea').style.display = 'block';
        }

        // Adicionar aula à lista
        function adicionarAulaLista() {
            const titulo = document.getElementById('tituloAula').value.trim();
            const descricao = document.getElementById('descricaoAula').value.trim();
            const urlVideo = document.getElementById('urlVideo').value.trim();

            // Validações
            if (!titulo || !descricao) {
                alert('Por favor, preencha o título e a descrição da aula!');
                return;
            }

            if (!videoAtual && !urlVideo) {
                alert('Por favor, faça upload de um vídeo ou insira uma URL!');
                return;
            }

            // Criar objeto da aula
            const novaAula = {
                id: Date.now(),
                titulo: titulo,
                descricao: descricao,
                video: videoAtual ? videoAtual.name : urlVideo,
                tipo: videoAtual ? 'arquivo' : 'url'
            };

            aulas.push(novaAula);
            renderizarAulas();

            // Limpar formulário
            limparFormulario();

            alert('Aula adicionada à lista com sucesso!');
        }

        // Renderizar lista de aulas
        function renderizarAulas() {
            const container = document.getElementById('listaAulas');
            const contador = document.getElementById('contadorAulas');

            contador.textContent = `${aulas.length} aula${aulas.length !== 1 ? 's' : ''}`;

            if (aulas.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <i class="bi bi-camera-video" style="font-size: 3rem; opacity: 0.3;"></i>
                        <p style="margin-top: 15px;">Nenhuma aula adicionada ainda</p>
                        <small>Preencha o formulário acima e clique em "Adicionar Aula à Lista"</small>
                    </div>
                `;
                return;
            }

            container.innerHTML = aulas.map((aula, index) => `
                <div class="aula-video-card">
                    <div class="aula-video-card-header">
                        <div class="aula-video-numero">
                            <i class="bi bi-play-circle"></i> Aula ${index + 1}
                        </div>
                        <div class="aula-video-acoes">
                            <button class="aula-btn-acao aula-btn-editar" onclick="editarAula(${aula.id})" title="Editar">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="aula-btn-acao aula-btn-excluir" onclick="excluirAula(${aula.id})" title="Excluir">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="aula-video-info">
                        <h4><i class="bi bi-camera-video" style="color: #5C22AD; margin-right: 8px;"></i>${aula.titulo}</h4>
                        <p>${aula.descricao}</p>
                        <p style="margin-top: 10px; color: #5C22AD; font-size: 0.9rem;">
                            <i class="bi bi-${aula.tipo === 'arquivo' ? 'file-earmark-play' : 'link-45deg'}"></i> 
                            ${aula.video}
                        </p>
                    </div>
                </div>
            `).join('');
        }

        // Editar aula
        function editarAula(id) {
            const aula = aulas.find(a => a.id === id);
            if (!aula) return;

            document.getElementById('tituloAula').value = aula.titulo;
            document.getElementById('descricaoAula').value = aula.descricao;
            
            if (aula.tipo === 'url') {
                document.getElementById('urlVideo').value = aula.video;
            }

            // Remover da lista (será adicionada novamente ao salvar)
            excluirAula(id, false);

            window.scrollTo({ top: 0, behavior: 'smooth' });
            alert('Aula carregada para edição! Faça as alterações e clique em "Adicionar Aula à Lista".');
        }

        // Excluir aula
        function excluirAula(id, confirmar = true) {
            if (confirmar && !confirm('Tem certeza que deseja excluir esta aula?')) {
                return;
            }

            aulas = aulas.filter(a => a.id !== id);
            renderizarAulas();
        }

        // Limpar formulário
        function limparFormulario() {
            document.getElementById('tituloAula').value = '';
            document.getElementById('descricaoAula').value = '';
            document.getElementById('urlVideo').value = '';
            removerVideo();
        }

        // Salvar todas as aulas
        function salvarAulas() {
            if (aulas.length === 0) {
                alert('Adicione pelo menos uma aula antes de salvar!');
                return;
            }

            console.log('Aulas para enviar ao backend:', aulas);
            alert(`${aulas.length} aula${aulas.length !== 1 ? 's' : ''} salva${aulas.length !== 1 ? 's' : ''} com sucesso!\n\nAgora você pode voltar para a página do módulo.`);
            
            // Aqui você enviaria os dados para o backend
            // fetch('/api/salvar-aulas', { method: 'POST', body: JSON.stringify(aulas) })
        }

        // Cancelar
        function cancelar() {
            if (aulas.length > 0) {
                if (!confirm('Você tem aulas não salvas. Tem certeza que deseja sair?')) {
                    return;
                }
            }
            window.history.back();
        }
    </script>
{% endblock %}